# Jeedom Plugin for Eufy Devices/Stations

![Logo Jeedom](../images/jeedom.png)
![Logo Plugin](../images/eufy.png)

## Documentation
- [Configuration](#configuration)
- [Synchronization](#synchronization)
- [Health](#health)
- [Equipments](#equipments)
- [Bugs and troubleshooting](#troubleshooting)

### Configuration
![Configuration](../images/eufy3.png)

Install the plugin and its dependencies.
<br>Choose either local or remote docker mode.
<br>Don't forget to save the configuration <b>BEFORE</b> launching the dependencies installation.
<br>Note: This action does NOT install the `eufy-security-ws` image.

#### 1. Common parameters
- Docker IP: `eufy-security-ws` container host IP, `127.0.0.1` by default
- Docker Port: `eufy-security-ws` container port, `3000` by default
- Target version: `latest` by default or the wanted version
- Test communication: Check connexion to `eufy-security-ws` container

Notes:
- The Eufy daemon won't start if the `eufy-security-ws` container can't connect to the Eufy Cloud service
- The `Version` field below displays your installed image version (if any)

#### 2. Local mode

The local mode requires the `docker` prerequisites. They are now automatically installed and configured.

The plugin doesn't depend on `#plugin-docker2` but it's possible to import the `data/docker-compose.yml` generated file if you prefer to manage the image yourself.

Extra parameters:
- Device: name of your phone in the Eufy app, used to connect the Eufy Cloud server
- User and password: it's strongly advised to create a dedicated user

Docker image post-installation setup:

- Install: install and start the `eufy-security-ws` image
- Restart: restart the `eufy-security-ws` image. Use if you change the image settings
- Uninstall: stop and uninstall the `eufy-security-ws` image
- Upgrade: upgrade the `eufy-security-ws` image to the given version

#### 3. Local mode using the command line (expert)
Once the dependencies are installed you can also use the `eufy` script found in `resources` to install,check 
and manage the `eufy-security-ws` image from the command line:

```
$ ./eufy -h
usage: ./eufy [-h] [-d device] [-u url] action
-h show this help message and exit
action: { install|uninstall|upgrade|start|stop|restart|status|info|logs|test }
test optional arguments:
      -d DEVICE device serial number
      -u URL eufy service URL, default 127.0.0.1:3000
```

#### 4. Remote mode (expert)

Here are the files to adapt and copy on the remote docker:

```
resources/docker-compose.yaml
resources/eufy
```

####  5. Connectivity issues
If something goes wrong first run the `eufy` script available in `resources`:
<br>`eufy test`
<br>Or:
<br>`python3 resources/test_eufy.py -u server:port`
<br>
<br> you should get something like this:

```
{"type":"result","success":true,"result":{"state":{"driver":{"version":"2.4.0","connected":true,"pushConnected":true}
```

Note that `connected` and `pushConnected` need to be `true`

### Synchronization
![Configuration](../images/eufy2.png)

Note: for now only some devices have been tested. If your device is not supported you can send me the output 
from the `test_eufy.py` program. Please see [here](../../README.md#untested-devices) for details.

### Health
![Configuration](../images/eufy1.png)

Lists the recognized devices and their status. 

### Equipments
![Equipments](../images/eufy4.png)
![Equipments](../images/eufy5.png)
![Equipments](../images/eufy6.png)

### Enabling snapshots
Snapshots are only generated at event detection (Alarm mode). 
<br> The `URL snapshot` command contains the server's picture URL
<br> You can use my [ImageViewer](https://github.com/lxrootard/widgets_v4) widget
<br> Enable picture notifications in your devices parameters from the Eufy app or the snapshots won't refresh
 
### RTSP video stream
RTSP support depends on devices, see the supported models 
[here](https://service.eufy.com/article-description/Storage-Methods-Compatibility-for-eufySecurity-Device) (NAS column)
<br>The RTSP stream can be accessed with the [Camera](https://doc.jeedom.com/en_US/plugins/security/camera) plugin or any player such as VLC.
<br>On battery-powered cams it needs to be activated/deactivated using the `start_rtsp` and `stop_rtsp` equipment commands.
<br>Depending on devices login/passwd is either the Eufy account id or random generated by the application on the
`Parameters > General > Storage > NAS(RTSP)` page
<br>IP is either the one from the base or from the camera 
<br>`live0...liven` indicates the camera number, see the screenshot below:

![RTSP video stream](../images/camera_plugin.jpg)

<br>Settings: see [here](https://camlytics.com/camera/eufy) and [here](https://support.eufy.com/s/article/Using-NAS-Storage-Step-by-Step)

### Bugs and troubleshooting
See [here](../../README.md#Troubleshooting)
